import{_ as b}from"./ChatContainer-UUB5cO7F.js";import{_ as w,V as I,h as k,E as C,j as x,G as M,k as S,P as d,y as U,r as L,c,o as l,d as a,b as N,e as p,f as r,l as u,N as h,t as T,w as V}from"./index-BuJvUBZ3.js";const $={class:"relative min-h-screen bg-white pb-8"},j={class:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 py-6 px-4 md:py-8"},B={class:"container mx-auto"},D={class:"bg-white rounded-xl shadow-xl overflow-hidden border border-gray-100 transition-all duration-300 hover:shadow-2xl"},E={class:"p-5 md:p-6 border-b bg-gradient-to-r from-indigo-500 to-purple-600"},A={class:"text-xl md:text-2xl font-bold text-white flex items-center"},F={class:"inline-block mr-3 bg-white/20 backdrop-blur-sm text-white p-2 rounded-full"},Q={key:0,class:"mt-4 ml-11"},G={class:"inline-flex items-center bg-red-100 text-red-600 px-4 py-2 rounded-full text-sm font-medium shadow-sm"},H={key:0,class:"h-[calc(100vh-220px)] flex items-center justify-center"},K={key:1,class:"h-[calc(100vh-220px)]"},O={key:2,class:"h-[calc(100vh-220px)] flex items-center justify-center"},P={class:"text-center max-w-md mx-auto p-8 bg-white/60 backdrop-blur-sm rounded-xl shadow-md"},q={class:"bg-indigo-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6"},z={__name:"MessageCenter",setup(J){const e=I(),m=k(),v=C(()=>e.unreadCount),g=x(!1),f=x(!0),_=s=>{var n,i;if(console.log("Nhận được tin nhắn socket trong MessageCenter:",s),s.type==="new_message"||s.data&&s.data.type==="new_message"){const t=s.data?s.data:s;if(t.recipient_fullname&&t.sender_id){const o=parseInt(t.sender_id,10);e.userInfoCache[o]||(e.userInfoCache[o]={user_id:o,fullname:t.recipient_fullname,avatar:null},console.log(`Đã thêm thông tin người dùng ${o} vào cache: ${t.recipient_fullname}`))}if(t.message)e.addMessage(t.message);else{const o={id:parseInt(t.message_id,10),sender:parseInt(t.sender_id,10),recipient:parseInt(t.recipient_id,10),content:t.content,is_read:t.is_read||!1,created_at:t.created_at||new Date().toISOString(),recipient_fullname:t.recipient_fullname||null};e.addMessage(o),o.sender!==((n=m.userInfo)==null?void 0:n.user_id)?(e.setLastMessage(o.sender,o),e.sortConversationToTop(o)):o.recipient!==((i=m.userInfo)==null?void 0:i.user_id)&&(e.setLastMessage(o.recipient,o),e.sortConversationToTop(o))}e.fetchUnreadMessages()}};M(()=>e.conversations,s=>{g.value=!s||s.length===0},{immediate:!0});const y=async()=>{var n;const s=(n=m.userInfo)==null?void 0:n.user_id;if(!(!s||!e.conversations))for(const i of e.conversations){const t=i.sender===s?i.recipient:i.sender;if(!e.userInfoCache[t])try{await e.fetchUserInfo(t),console.log(`Đã tải thông tin cho người dùng ${t}`)}catch(o){console.error(`Lỗi khi tải thông tin cho người dùng ${t}:`,o)}}};return S(async()=>{d.connected||d.init(),d.onMessage(_),e.resetStore();try{f.value=!0,await e.fetchConversations(),await y(),await e.fetchLatestMessages(),await e.fetchUnreadMessages(),g.value=!e.conversations||e.conversations.length===0;const s=setInterval(async()=>{await e.fetchUnreadMessages()},3e4);U(()=>{clearInterval(s),d.offMessage(_)})}catch(s){console.error("Lỗi khi tải dữ liệu cho MessageCenter:",s)}finally{f.value=!1}}),(s,n)=>{const i=L("router-link");return l(),c("div",$,[a("div",j,[a("div",B,[a("div",D,[a("div",E,[a("div",null,[a("h1",A,[a("span",F,[r(u(h),{icon:"comments"})]),n[0]||(n[0]=p(" Trung tâm tin nhắn "))]),n[1]||(n[1]=a("p",{class:"text-indigo-100 mt-1 pl-11"}," Quản lý và trả lời tin nhắn của ứng viên ",-1))]),v.value>0?(l(),c("div",Q,[a("div",G,[r(u(h),{icon:"envelope",class:"mr-2"}),p(" "+T(v.value)+" tin nhắn chưa đọc ",1)])])):N("",!0)]),f.value?(l(),c("div",H,n[2]||(n[2]=[a("div",{class:"text-center"},[a("i",{class:"fas fa-circle-notch fa-spin text-indigo-500 text-3xl mb-4"}),a("p",{class:"text-gray-600"},"Đang tải tin nhắn...")],-1)]))):g.value?(l(),c("div",O,[a("div",P,[a("div",q,[r(u(h),{icon:"comments",class:"text-indigo-500 text-3xl"})]),n[4]||(n[4]=a("h3",{class:"text-xl font-medium text-gray-800 mb-3"},"Hộp tin nhắn trống",-1)),n[5]||(n[5]=a("p",{class:"text-gray-600 mb-6 leading-relaxed"}," Bạn chưa có cuộc trò chuyện nào với ứng viên. Khi ứng viên liên hệ, tin nhắn sẽ xuất hiện ở đây. ",-1)),r(i,{to:"/employer/posts",class:"inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-1 duration-200"},{default:V(()=>[r(u(h),{icon:"briefcase",class:"mr-2"}),n[3]||(n[3]=p(" Quản lý tin tuyển dụng "))]),_:1})])])):(l(),c("div",K,[r(b)]))])])])])}}},X=w(z,[["__scopeId","data-v-c6ccca5d"]]);export{X as default};
