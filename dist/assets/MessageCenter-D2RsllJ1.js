import{C as y}from"./ChatContainer-DNL2nsLp.js";import{_ as w,V as C,h as I,E as M,j as x,G as k,k as S,P as d,y as N,r as T,c,o as l,d as n,b as U,e as p,f as r,l as u,N as m,t as L,w as V}from"./index-BC0viRdf.js";const j={class:"relative min-h-screen bg-white pb-8"},B={class:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 py-6 px-4 md:py-8"},D={class:"container mx-auto"},E={class:"bg-white rounded-xl shadow-xl overflow-hidden border border-gray-100 transition-all duration-300 hover:shadow-2xl"},A={class:"p-5 md:p-6 border-b bg-gradient-to-r from-indigo-500 to-purple-600"},F={class:"text-xl md:text-2xl font-bold text-white flex items-center"},Q={class:"inline-block mr-3 bg-white/20 backdrop-blur-sm text-white p-2 rounded-full"},$={key:0,class:"mt-4 ml-11"},G={class:"inline-flex items-center bg-red-100 text-red-600 px-4 py-2 rounded-full text-sm font-medium shadow-sm"},H={key:0,class:"h-[calc(100vh-220px)] flex items-center justify-center"},K={key:1,class:"h-[calc(100vh-220px)]"},O={key:2,class:"h-[calc(100vh-220px)] flex items-center justify-center"},P={class:"text-center max-w-md mx-auto p-8 bg-white/60 backdrop-blur-sm rounded-xl shadow-md"},q={class:"bg-indigo-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6"},z={__name:"MessageCenter",setup(J){const e=C(),h=I(),v=M(()=>e.unreadCount),f=x(!1),g=x(!0),_=t=>{var s,i;if(console.log("Nhận được tin nhắn socket trong MessageCenter:",t),t.type==="new_message"||t.data&&t.data.type==="new_message"){const o=t.data?t.data:t;if(o.recipient_fullname&&o.sender_id){const a=parseInt(o.sender_id,10);e.userInfoCache[a]||(e.userInfoCache[a]={user_id:a,fullname:o.recipient_fullname,avatar:null},console.log(`Đã thêm thông tin người dùng ${a} vào cache: ${o.recipient_fullname}`))}if(o.message)e.addMessage(o.message);else{const a={id:parseInt(o.message_id,10),sender:parseInt(o.sender_id,10),recipient:parseInt(o.recipient_id,10),content:o.content,is_read:o.is_read||!1,created_at:o.created_at||new Date().toISOString(),recipient_fullname:o.recipient_fullname||null};e.addMessage(a),a.sender!==((s=h.userInfo)==null?void 0:s.user_id)?(e.setLastMessage(a.sender,a),e.sortConversationToTop(a)):a.recipient!==((i=h.userInfo)==null?void 0:i.user_id)&&(e.setLastMessage(a.recipient,a),e.sortConversationToTop(a))}e.fetchUnreadMessages()}};k(()=>e.conversations,t=>{f.value=!t||t.length===0},{immediate:!0});const b=async()=>{var s;const t=(s=h.userInfo)==null?void 0:s.user_id;if(!(!t||!e.conversations))for(const i of e.conversations)i.sender===t?i.recipient:i.sender};return S(async()=>{d.connected||d.init(),d.onMessage(_),e.resetStore();try{g.value=!0,await e.fetchConversations(),await b(),await e.fetchLatestMessages(),await e.fetchUnreadMessages(),f.value=!e.conversations||e.conversations.length===0;const t=setInterval(async()=>{await e.fetchUnreadMessages()},3e4);N(()=>{clearInterval(t),d.offMessage(_)})}catch(t){console.error("Lỗi khi tải dữ liệu cho MessageCenter:",t)}finally{g.value=!1}}),(t,s)=>{const i=T("router-link");return l(),c("div",j,[n("div",B,[n("div",D,[n("div",E,[n("div",A,[n("div",null,[n("h1",F,[n("span",Q,[r(u(m),{icon:"comments"})]),s[0]||(s[0]=p(" Trung tâm tin nhắn "))]),s[1]||(s[1]=n("p",{class:"text-indigo-100 mt-1 pl-11"}," Quản lý và trả lời tin nhắn của ứng viên ",-1))]),v.value>0?(l(),c("div",$,[n("div",G,[r(u(m),{icon:"envelope",class:"mr-2"}),p(" "+L(v.value)+" tin nhắn chưa đọc ",1)])])):U("",!0)]),g.value?(l(),c("div",H,s[2]||(s[2]=[n("div",{class:"text-center"},[n("i",{class:"fas fa-circle-notch fa-spin text-indigo-500 text-3xl mb-4"}),n("p",{class:"text-gray-600"},"Đang tải tin nhắn...")],-1)]))):f.value?(l(),c("div",O,[n("div",P,[n("div",q,[r(u(m),{icon:"comments",class:"text-indigo-500 text-3xl"})]),s[4]||(s[4]=n("h3",{class:"text-xl font-medium text-gray-800 mb-3"},"Hộp tin nhắn trống",-1)),s[5]||(s[5]=n("p",{class:"text-gray-600 mb-6 leading-relaxed"}," Bạn chưa có cuộc trò chuyện nào với ứng viên. Khi ứng viên liên hệ, tin nhắn sẽ xuất hiện ở đây. ",-1)),r(i,{to:"/employer/posts",class:"inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-1 duration-200"},{default:V(()=>[r(u(m),{icon:"briefcase",class:"mr-2"}),s[3]||(s[3]=p(" Quản lý tin tuyển dụng "))]),_:1})])])):(l(),c("div",K,[r(y)]))])])])])}}},X=w(z,[["__scopeId","data-v-08fc3d43"]]);export{X as default};
