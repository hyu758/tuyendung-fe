import{_,V as k,i as I,B as C,u as M,k as N,Y as y,E as q,o as P,P as u,y as T,r as U,c as i,a,e as t,d as v,f as m,g as h,l as p,N as S,w as B,b as V}from"./index-DGtN128i.js";import{_ as E}from"./ChatContainer-CvH8pIha.js";const L={class:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 py-6 px-4 md:py-8"},j={class:"container mx-auto"},z={class:"bg-white rounded-xl shadow-xl overflow-hidden border border-gray-100 transition-all duration-300 hover:shadow-2xl"},A={class:"p-5 md:p-6 border-b bg-gradient-to-r from-indigo-500 to-purple-600"},D={class:"text-xl md:text-2xl font-bold text-white flex items-center"},H={class:"inline-block mr-3 bg-white/20 backdrop-blur-sm text-white p-2 rounded-full"},R={key:0,class:"mt-3 ml-11 flex items-center"},G={key:0,class:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-10",style:{top:"180px"}},F={class:"text-center px-4 py-6 max-w-md mx-auto"},K={key:1,class:"flex items-center justify-center h-[calc(100vh-220px)] md:h-[calc(100vh-200px)]"},Y={key:2,class:"h-[calc(100vh-220px)] md:h-[calc(100vh-200px)] transition-all duration-300 relative"},$={__name:"MessageCenter",setup(J){const d=k(),o=I(),s=C(),g=M(),f=N(!0),b=()=>{var n;return o.isLoggedIn?o.isCandidate?((n=o.userInfo)!=null&&n.is_premium||console.log("Người dùng không phải Premium, nhưng vẫn hiển thị giao diện với thông báo nâng cấp"),!0):(console.log("Người dùng không phải ứng viên, chuyển hướng đến trang chủ"),g.replace({name:"Home"}),!1):(console.log("Người dùng chưa đăng nhập, chuyển hướng đến trang đăng nhập"),g.replace({name:"Login",query:{redirect:s.fullPath}}),!1)};y("chatUserId",s.query.user?parseInt(s.query.user,10):null),y("isPremiumUser",q(()=>{var n;return((n=o.userInfo)==null?void 0:n.is_premium)||!1}));const x=n=>{var l;console.log("MessageCenter nhận được tin nhắn mới qua socket:",n),d.fetchUnreadMessages();const e=s.query.user?parseInt(s.query.user,10):null;if(e){const r=((l=n.data)==null?void 0:l.type)==="new_message"?n.data:n,c=parseInt(r.sender_id,10),w=parseInt(r.recipient_id,10);(c===e||w===e)&&console.log("Tin nhắn liên quan đến cuộc trò chuyện đang mở, cập nhật tin nhắn")}};return P(()=>{console.log("MessageCenter đã được mount"),console.log("Tham số URL hiện tại:",s.query),o.fetchUserProfile().then(()=>{var n;if(console.log("[DEBUG] Thông tin người dùng sau khi tải profile:",o.userInfo),console.log("[DEBUG] Trạng thái premium sau khi tải profile:",(n=o.userInfo)==null?void 0:n.is_premium),!!b()&&(d.resetStore(),d.fetchUnreadMessages().finally(()=>{setTimeout(()=>{f.value=!1},500)}),u.connected||(console.log("Khởi tạo kết nối socket trong MessageCenter"),u.init()),u.onMessage(x),s.query.user)){console.log("Đang truy cập trang tin nhắn với userId:",s.query.user);const e=parseInt(s.query.user,10);isNaN(e)&&(console.error("user_id không hợp lệ:",s.query.user),g.replace({name:"candidate-messages"}))}})}),T(()=>{console.log("MessageCenter unmounted: Hủy đăng ký socket handlers"),u.offMessage(x)}),(n,e)=>{var r,c;const l=U("router-link");return a(),i("div",L,[t("div",j,[t("div",z,[t("div",A,[t("h1",D,[t("span",H,[h(p(S),{icon:"comments"})]),e[0]||(e[0]=m(" Tin nhắn của tôi "))]),e[2]||(e[2]=t("p",{class:"text-indigo-100 mt-1 pl-11"}," Trò chuyện với nhà tuyển dụng của bạn ",-1)),(r=p(o).userInfo)!=null&&r.is_premium?v("",!0):(a(),i("div",R,e[1]||(e[1]=[t("div",{class:"bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium inline-flex items-center"},[t("i",{class:"fas fa-crown text-yellow-600 mr-2"}),m(" Tính năng dành cho người dùng Premium ")],-1)])))]),(c=p(o).userInfo)!=null&&c.is_premium?v("",!0):(a(),i("div",G,[t("div",F,[e[4]||(e[4]=t("div",{class:"w-24 h-24 mb-4 flex items-center justify-center bg-yellow-50 rounded-full mx-auto"},[t("i",{class:"fas fa-crown text-yellow-500 text-4xl"})],-1)),e[5]||(e[5]=t("h2",{class:"text-xl font-bold text-gray-800 mb-2"},"Tính năng dành cho người dùng Premium",-1)),e[6]||(e[6]=t("p",{class:"text-gray-600 mb-6"},"Để có thể nhắn tin với nhà tuyển dụng, bạn cần nâng cấp tài khoản lên gói Premium.",-1)),h(l,{to:"/premium",class:"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 mx-auto w-max hover:shadow-lg transition duration-300"},{default:B(()=>e[3]||(e[3]=[t("i",{class:"fas fa-crown"},null,-1),m(" Nâng cấp Premium ngay ")])),_:1})])])),f.value?(a(),i("div",K,e[7]||(e[7]=[V('<div class="flex flex-col items-center space-y-4" data-v-bf63c387><svg class="animate-spin h-10 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" data-v-bf63c387><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" data-v-bf63c387></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" data-v-bf63c387></path></svg><span class="text-gray-500" data-v-bf63c387>Đang tải tin nhắn...</span></div>',1)]))):(a(),i("div",Y,[h(E)]))])])])}}},W=_($,[["__scopeId","data-v-bf63c387"]]);export{W as default};
