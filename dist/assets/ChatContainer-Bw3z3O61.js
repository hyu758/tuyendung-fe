import{E as A,c as h,a as u,e as a,t as U,n as D,f as J,d as B,k as $,Z,G as E,m as X,v as ee,M as re,q as z,V as ie,i as le,T as ce,B as ue,Q as O,o as de,P as _,y as he,l as w,F as V,h as G,s as Q,g as ge}from"./index-B0ZRND4a.js";const fe={class:"whitespace-pre-wrap text-[15px]"},me={key:0,class:"ml-1"},ve={key:0,class:"fas fa-check-double"},ye={key:1,class:"fas fa-check"},pe={__name:"ChatMessage",props:{content:{type:String,required:!0},isCurrentUser:{type:Boolean,default:!1},isRead:{type:Boolean,default:!1},createdAt:{type:[String,Date],required:!0}},setup(l){const t=l,y=A(()=>{const m=new Date(t.createdAt);if(isNaN(m.getTime()))return"";const v=new Date,x=v-m,S=Math.floor(x/(1e3*60*60)),g=Math.floor(x/(1e3*60*60*24)),M=m.getHours().toString().padStart(2,"0"),T=m.getMinutes().toString().padStart(2,"0"),b=`${M}:${T}`;if(S<24&&m.getDate()===v.getDate())return b;if(g<7)return`${["CN","T2","T3","T4","T5","T6","T7"][m.getDay()]} ${b}`;if(m.getFullYear()===v.getFullYear()){const C=m.getDate().toString().padStart(2,"0"),H=(m.getMonth()+1).toString().padStart(2,"0");return`${C}/${H} ${b}`}const o=m.getDate().toString().padStart(2,"0"),d=(m.getMonth()+1).toString().padStart(2,"0"),p=m.getFullYear();return`${o}/${d}/${p} ${b}`});return(m,v)=>(u(),h("div",{class:D(["flex",l.isCurrentUser?"justify-end":"justify-start","mb-3"])},[a("div",{class:D(["max-w-[70%] rounded-2xl px-4 py-2.5 break-words shadow-sm",l.isCurrentUser?"bg-blue-500 text-white rounded-br-none":"bg-gray-100 text-gray-800 rounded-bl-none"])},[a("p",fe,U(l.content),1),a("div",{class:D(["text-xs mt-1 flex justify-end items-center",l.isCurrentUser?"text-blue-100":"text-gray-500"])},[J(U(y.value)+" ",1),l.isCurrentUser?(u(),h("span",me,[l.isRead?(u(),h("i",ve)):(u(),h("i",ye))])):B("",!0)],2)],2)],2))}},xe={class:"flex-shrink-0 mr-3 relative"},be={key:0,class:"w-12 h-12 rounded-md overflow-hidden shadow-sm"},Ce=["src"],ke={key:1,class:"w-12 h-12 bg-gradient-to-r from-blue-400 to-blue-500 rounded-md flex items-center justify-center text-white font-bold shadow-sm"},we={key:2,class:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"},Me={class:"flex-1 min-w-0"},Se={class:"flex justify-between items-center"},Te={class:"flex items-center mt-1"},Ie={key:0,class:"ml-2 bg-blue-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[20px] text-center shadow-sm"},$e={__name:"ChatConversation",props:{displayName:{type:String,required:!0},avatar:{type:String,default:null},lastMessage:{type:String,default:""},lastMessageTime:{type:String,default:""},unreadCount:{type:Number,default:0},isOnline:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},isRead:{type:Boolean,default:!0},userId:{type:[Number,String],required:!0},openInPopup:{type:Boolean,default:!1}},emits:["select"],setup(l,{emit:t}){const y=l,m=t,v=$(!1),x=Z("openChat",null),S=o=>{if(!o)return!1;try{if(o.startsWith("src/assets/")||o.startsWith("/src/assets/"))return console.error("Đường dẫn avatar assets không tồn tại:",o),!1;const d=new URL(o);return o.match(/\.(jpeg|jpg|gif|png|webp)$/i)||o.includes("cloudinary.com")||o.includes("res.cloudinary.com"),!0}catch(d){return console.error("URL avatar không hợp lệ:",o,d),!1}},g=o=>{console.warn("Lỗi khi tải avatar:",y.avatar),v.value=!0,o.target.src="";try{const d=o.target.closest(".rounded-md");if(d){o.target.style.display="none";const p=document.createElement("div");p.className="w-full h-full bg-gradient-to-r from-blue-400 to-blue-500 flex items-center justify-center text-white font-bold",p.textContent=T(y.displayName),d.appendChild(p),console.log(`Đã thay thế avatar lỗi cho ${y.displayName} với initials: ${T(y.displayName)}`)}}catch(d){console.error("Lỗi khi xử lý DOM sau lỗi avatar:",d)}},M=A(()=>{if(!y.lastMessageTime)return"";const o=new Date(y.lastMessageTime),d=new Date,p=d-o,C=Math.floor(p/(1e3*60)),H=Math.floor(p/(1e3*60*60)),F=Math.floor(p/(1e3*60*60*24));if(C<1)return"Vừa xong";if(C<60)return`${C} phút`;if(H<24&&o.getDate()===d.getDate()){const N=o.getHours().toString().padStart(2,"0"),L=o.getMinutes().toString().padStart(2,"0");return`${N}:${L}`}else{if(F<7)return["CN","T2","T3","T4","T5","T6","T7"][o.getDay()];if(o.getFullYear()===d.getFullYear()){const N=o.getDate().toString().padStart(2,"0"),L=(o.getMonth()+1).toString().padStart(2,"0");return`${N}/${L}`}else{const N=o.getDate().toString().padStart(2,"0"),L=(o.getMonth()+1).toString().padStart(2,"0"),I=o.getFullYear().toString().slice(2);return`${N}/${L}/${I}`}}}),T=o=>o?o.trim().charAt(0).toUpperCase():"?",b=()=>{y.openInPopup&&x?x(y.userId):m("select")};return(o,d)=>(u(),h("div",{class:D(["flex items-center px-4 py-3 cursor-pointer transition-colors border-b border-gray-100",{"bg-blue-50":l.isActive,"hover:bg-gray-50":!l.isActive,"border-l-4 border-l-blue-500":l.isActive}]),onClick:b},[a("div",xe,[l.avatar&&S(l.avatar)?(u(),h("div",be,[a("img",{src:l.avatar,alt:"Avatar",class:"w-full h-full object-cover",onError:g},null,40,Ce)])):(u(),h("div",ke,U(T(l.displayName)),1)),l.isOnline?(u(),h("div",we)):B("",!0)]),a("div",Me,[a("div",Se,[a("h3",{class:D(["text-sm font-medium truncate",[l.unreadCount>0?"text-gray-900 font-semibold":"text-gray-700"]])},U(l.displayName||`Người dùng #${l.userId}`),3),a("span",{class:D(["text-xs text-gray-500",[l.unreadCount>0?"text-blue-600 font-semibold":"text-gray-500"]])},U(M.value),3)]),a("div",Te,[a("p",{class:D(["text-sm truncate flex-1",{"text-gray-700 font-medium":!l.isRead&&l.unreadCount>0,"text-gray-500":l.isRead||l.unreadCount===0}])},U(l.lastMessage),3),l.unreadCount>0?(u(),h("span",Ie,U(l.unreadCount>99?"99+":l.unreadCount),1)):B("",!0)])])],2))}},Ne={class:"border-t border-gray-100 py-3 px-4 bg-white"},_e={class:"relative flex-1"},Ue=["onKeydown"],De=["disabled"],Le={__name:"ChatInput",props:{loading:{type:Boolean,default:!1}},emits:["send-message"],setup(l,{emit:t}){const y=l,m=t,v=$(""),x=$(null),S=$(1);$(!1);const g=A(()=>v.value.trim().length>0&&!y.loading),M=()=>{g.value&&(m("send-message",v.value.trim()),v.value="",S.value=1,setTimeout(()=>{x.value.focus()},10))},T=o=>{o.shiftKey||M()},b=()=>{const o=v.value.split(`
`);S.value=Math.min(o.length,5)};return E(v,()=>{b()}),(o,d)=>(u(),h("div",Ne,[a("form",{onSubmit:z(M,["prevent"]),class:"flex items-end gap-2"},[a("div",_e,[X(a("textarea",{"onUpdate:modelValue":d[0]||(d[0]=p=>v.value=p),placeholder:"Nhập tin nhắn...",class:D(["w-full border-gray-200 border rounded-2xl px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none bg-gray-50",{"h-10":S.value===1,"h-20":S.value>1}]),onKeydown:re(z(T,["prevent"]),["enter"]),onInput:b,ref_key:"textarea",ref:x},null,42,Ue),[[ee,v.value]])]),a("button",{type:"submit",class:D(["bg-blue-500 hover:bg-blue-600 text-white rounded-full w-11 h-11 flex items-center justify-center shadow-sm transition-colors",{"opacity-50 cursor-not-allowed":!g.value,"hover:shadow-md":g.value}]),disabled:!g.value},d[1]||(d[1]=[a("i",{class:"fab fa-telegram-plane"},null,-1)]),10,De)],32)]))}},je={class:"h-full flex bg-white shadow-md rounded-lg overflow-hidden"},Ae={class:"w-1/3 border-r border-gray-100 flex flex-col"},Be={class:"py-3 px-4 border-b border-gray-100 bg-white"},He={class:"relative mt-2"},Re={class:"flex-1 overflow-y-auto"},We={key:0,class:"p-4 text-center"},Oe={key:1,class:"p-4 text-center"},Ee={class:"w-2/3 flex flex-col"},Fe={class:"py-3 px-4 border-b border-gray-100 flex items-center justify-between bg-white shadow-sm"},Ve={class:"flex items-center"},qe={class:"w-10 h-10 bg-blue-100 rounded-md flex items-center justify-center overflow-hidden mr-3"},Pe=["src"],Ke={key:1,class:"w-full h-full bg-gradient-to-r from-blue-400 to-blue-500 rounded-md flex items-center justify-center text-white font-bold"},Ye={class:"font-medium text-gray-800"},ze={key:0,class:"text-xs text-green-500"},Ge={key:1,class:"py-2 text-center mb-2"},Qe={key:2,class:"my-auto text-center"},Je={key:3,class:"my-auto text-center py-12"},Ze={class:"flex flex-col space-y-2"},Xe={key:0,class:"py-2 text-center"},et={key:1,class:"flex-1 flex items-center justify-center flex-col p-4"},st={__name:"ChatContainer",setup(l){const t=ie(),y=le(),m=ce(),v=ue(),x=$(""),S=$(null),g=$(null),M=$(!1),T=$(!0),b=Z("chatUserId",null);console.log("Giá trị userId được inject từ component cha:",b);const o=A(()=>{var e;return(e=y.userInfo)==null?void 0:e.user_id});E(()=>v.query.user,e=>{if(e){console.log("Tham số user đã thay đổi:",e);const n=parseInt(e,10);isNaN(n)||(console.log("Chọn cuộc trò chuyện mới từ URL thay đổi:",n),F(n))}},{immediate:!1});const d=A(()=>{if(!t.conversations.length)return[];const e=new Map;return t.conversations.forEach(s=>{const c=s.sender===o.value?s.recipient:s.sender,r=typeof c=="string"?parseInt(c,10):c,k=t.userInfoCache[r];let f=t.lastMessages[r];if(f){const W=typeof f.sender=="string"?parseInt(f.sender,10):f.sender,Y=typeof f.recipient=="string"?parseInt(f.recipient,10):f.recipient;W===o.value&&Y===r||W===r&&Y===o.value||(f=null)}let j="";k&&k.fullname?j=k.fullname:f&&f.recipient_fullname&&r!==o.value?j=f.recipient_fullname:f&&f.sender_fullname?j=f.sender_fullname:j=`Người dùng #${r}`,e.has(r)||e.set(r,{userId:r,displayName:j,avatar:(k==null?void 0:k.avatar)||null,isOnline:!1,lastMessage:(f==null?void 0:f.content)||"",lastMessageTime:(f==null?void 0:f.created_at)||"",unreadCount:0})}),Array.from(e.values()).sort((s,i)=>s.lastMessageTime?i.lastMessageTime?new Date(i.lastMessageTime)-new Date(s.lastMessageTime):-1:1)}),p=A(()=>{if(!x.value)return d.value;const e=x.value.toLowerCase();return d.value.filter(n=>n.displayName.toLowerCase().includes(e))}),C=A(()=>t.activeConversation?d.value.find(e=>e.userId===t.activeConversation):null),H=e=>{console.log("Lấy tên hiển thị cho conversation:",e);const n=e.userId,s=t.userInfoCache[n];return s&&s.fullname?(s.avatar&&e.avatar===null&&(e.avatar=s.avatar),s.fullname):e.displayName||`Người dùng #${e.userId}`},F=async e=>{if(console.log("Đang chọn cuộc trò chuyện với userId:",e),t.activeConversation=e,S.value=e,t.activeConversation===e&&t.sortedMessages.length>0){console.log("Cuộc trò chuyện này đã được chọn và có tin nhắn, không tải lại");return}t.page=1,t.hasMoreMessages=!0;try{let n=!t.userInfoCache[e],s=null;n&&(s=t.fetchUserInfo(e));const i=await t.fetchMessages(e,!0);!i||i.length<20?t.hasMoreMessages=!1:t.hasMoreMessages=!0,await Promise.all([s].filter(Boolean)),await N(),await O(),setTimeout(()=>{I(),console.log("Đã cuộn xuống tin nhắn mới nhất sau khi chọn cuộc trò chuyện")},100)}catch(n){console.error("Lỗi khi tải tin nhắn:",n)}finally{t.loading=!1}},N=async()=>{const e=t.sortedMessages.filter(n=>!n.is_read&&n.sender!==o.value);if(e.length>0){console.log(`Đánh dấu ${e.length} tin nhắn là đã đọc`);for(const n of e)try{await t.markMessageAsRead(n.id)}catch(s){console.error(`Lỗi khi đánh dấu tin nhắn ${n.id} là đã đọc:`,s)}}},L=async e=>{if(t.activeConversation)try{const n=await t.sendMessage(t.activeConversation,e);console.log("📤 Đã gửi tin nhắn mới:",n);const s=d.value.find(i=>i.userId===t.activeConversation);s&&(console.log("Cập nhật tin nhắn mới nhất cho cuộc trò chuyện hiện tại:",s.userId),s.lastMessage=e,s.lastMessageTime=new Date().toISOString()),setTimeout(async()=>{try{console.log("Tải tin nhắn mới nhất sau khi gửi tin nhắn"),await t.fetchLatestMessages(),console.log("Đã cập nhật tin nhắn mới nhất cho tất cả cuộc trò chuyện")}catch(i){console.error("Lỗi khi tải tin nhắn mới nhất sau khi gửi:",i)}},500),setTimeout(()=>{const i=t.sortedMessages[t.sortedMessages.length-1];i&&i.content===e?console.log("✅ Tin nhắn đã được thêm vào danh sách, không cần mô phỏng"):(console.log("⚠️ Không tìm thấy tin nhắn mới trong danh sách, mô phỏng tin nhắn"),n&&(t.addMessage({...n,is_read:!0}),t.sortConversationToTop(n)))},500),await O(),I()}catch(n){console.error("Lỗi khi gửi tin nhắn:",n)}},I=()=>{g.value&&(console.log("Thực hiện cuộn xuống cuối cùng"),g.value.scrollTop=g.value.scrollHeight,setTimeout(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight,console.log("Đã cuộn xuống lần thứ hai để đảm bảo hiển thị tin nhắn mới nhất"))},100))},te=async()=>{if(!g.value||!t.activeConversation)return;const{scrollTop:e,clientHeight:n,scrollHeight:s}=g.value;if(T.value=s-e-n<100,e<=20&&!M.value&&t.hasMoreMessages){console.log("Đang tải thêm tin nhắn cũ hơn...");const i=s;M.value=!0;try{if(await t.fetchMessages(t.activeConversation),await O(),g.value){const k=g.value.scrollHeight-i+20;g.value.scrollTop=k,console.log(`Đã điều chỉnh scrollTop từ 0 đến ${k}px`)}}catch(c){console.error("Lỗi khi tải thêm tin nhắn cũ hơn:",c)}finally{setTimeout(()=>{M.value=!1},500)}}};E(()=>JSON.stringify(t.sortedMessages),()=>{if(console.log("Nội dung tin nhắn đã thay đổi (deep check)"),N(),g.value){const{scrollTop:e,scrollHeight:n,clientHeight:s}=g.value,i=n-e-s<300,c=t.sortedMessages[t.sortedMessages.length-1],r=c&&c.sender===o.value;(i||r)&&(console.log("Nội dung thay đổi và người dùng gần cuối hoặc gửi tin nhắn mới, đang cuộn xuống"),I(),O(()=>{I()}))}}),E(()=>t.sortedMessages.length,(e,n)=>{var s;if(e>n){console.log(`Số lượng tin nhắn đã tăng từ ${n} lên ${e}`);const i=t.sortedMessages[t.sortedMessages.length-1];if(i&&g.value){if(i.sender!==o.value){const W=t.userInfoCache[i.sender];W&&W.avatar&&!((s=t.activeConversation)!=null&&s.avatar)&&t.activeConversation&&(console.log("Cập nhật avatar cho người dùng đang trò chuyện:",i.sender),t.activeConversation.avatar=W.avatar)}const{scrollTop:c,scrollHeight:r,clientHeight:k}=g.value,f=r-c-k<300,j=i.sender===o.value;(f||j)&&(console.log("Có tin nhắn mới và người dùng gần cuối hoặc tin nhắn từ user hiện tại, cuộn xuống"),I())}}}),E(()=>t.activeConversation,(e,n)=>{e!==n&&(console.log(`Active conversation changed from ${n} to ${e}`),O(()=>{I()}))}),E(()=>t.sortedMessages,(e,n)=>{if(console.log("Tin nhắn thay đổi, danh sách cuộc trò chuyện sẽ được cập nhật"),e.length>n.length){const s=e[e.length-1];t.activeConversation===s.sender&&(console.log("Tin nhắn mới thuộc cuộc trò chuyện đang mở"),s.recipient===o.value&&!s.is_read&&t.markMessageAsRead(s.id))}},{deep:!0});const P=e=>{var n;if(console.log("Nhận tin nhắn từ socket:",e),e&&e.type==="chat_message"){const s=e.message;t.addMessage(s);const i=(n=y.userInfo)==null?void 0:n.user_id;if(s.sender!==i&&t.activeConversation!==s.sender){const c=t.userInfoCache[s.sender],r=(c==null?void 0:c.fullname)||`Người dùng #${s.sender}`;m.createMessageNotification(s.sender,s.content,r)}if(t.activeConversation===s.sender){t.markMessageAsRead(s.id);const c=d.value.find(r=>r.userId===s.sender);c&&(c.lastMessage=s.content,c.lastMessageTime=s.created_at,console.log("Cập nhật tin nhắn mới nhất cho cuộc trò chuyện đang mở:",c)),O(()=>{I()})}setTimeout(async()=>{try{console.log("Tải tin nhắn mới nhất sau khi nhận tin nhắn từ socket"),await t.fetchLatestMessages(),console.log("Đã cập nhật tin nhắn mới nhất cho tất cả cuộc trò chuyện")}catch(c){console.error("Lỗi khi tải tin nhắn mới nhất sau khi nhận tin nhắn socket:",c)}},500)}},ne=e=>{console.warn("Lỗi khi tải avatar trong header:",e),e.target.src="";const n=q(),s=K(),i=e.target.closest(".overflow-hidden");if(i){const c=document.createElement("div");c.className="w-full h-full bg-gradient-to-r from-blue-400 to-blue-500 flex items-center justify-center text-white font-bold",c.textContent=s,i.appendChild(c),e.target.style.display="none",console.log(`Đã thay thế avatar lỗi với chữ cái đầu: ${s} (${n})`)}C.value&&(C.value.avatar=null)},se=e=>{if(!e)return!1;try{return e.startsWith("src/assets/")||e.startsWith("/src/assets/")?(console.error("Đường dẫn avatar assets không tồn tại:",e),!1):(new URL(e),e.match(/\.(jpeg|jpg|gif|png|webp)$/i)||e.includes("cloudinary.com")||e.includes("res.cloudinary.com"),!0)}catch{return console.error("URL avatar không hợp lệ:",e),!1}},q=()=>{if(!t.activeConversation)return"Chọn một cuộc trò chuyện";const e=t.activeConversation,n=t.userInfoCache[e];if(n&&n.fullname)return n.fullname;const s=d.value.find(i=>i.userId===e);return s&&s.displayName?s.displayName:`Người dùng #${e}`},K=()=>{const e=q();return!e||e.startsWith("Người dùng #")?"?":e.trim().charAt(0).toUpperCase()};de(async()=>{console.log("ChatContainer đã được mount"),ae();let e=null;v.query.user?(e=parseInt(v.query.user,10),console.log("Tìm thấy tham số user trong URL:",e)):b&&(e=b,console.log("Sử dụng userId được inject:",e));try{await Promise.all([t.fetchConversations(),t.fetchUnreadMessages()]),await t.fetchLatestMessages(),console.log("Đã tải xong dữ liệu ban đầu, số cuộc trò chuyện:",t.conversations.length),e&&!isNaN(e)&&(console.log("Thực hiện chọn cuộc trò chuyện với userId:",e),await F(e)),oe()}catch(n){console.error("Lỗi khi khởi tạo ChatContainer:",n)}_.onMessage(P)});const ae=()=>{console.log("Đang khởi tạo kết nối WebSocket..."),_.init(),setTimeout(()=>{_.connected?console.log("✅ WebSocket đã kết nối thành công!"):(console.log("⚠️ WebSocket chưa kết nối sau 2 giây, thử kết nối lại..."),_.disconnect(),_.init())},2e3)};let R=null;const oe=()=>{R&&clearInterval(R),R=setInterval(()=>{_.connected?console.log("✓ WebSocket vẫn đang kết nối"):(console.log("⚠️ Phát hiện WebSocket đã ngắt kết nối, đang thử kết nối lại..."),_.init())},3e4)};return he(()=>{console.log("ChatContainer đã được unmount"),R&&(clearInterval(R),R=null),_.disconnect(),_.offMessage(P)}),(e,n)=>{var s,i,c;return u(),h("div",je,[a("div",Ae,[a("div",Be,[n[2]||(n[2]=a("h2",{class:"text-lg font-semibold text-gray-800"},"Tin nhắn",-1)),a("div",He,[X(a("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=r=>x.value=r),placeholder:"Tìm kiếm cuộc trò chuyện...",class:"w-full border-gray-200 border rounded-xl pl-9 pr-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent bg-gray-50"},null,512),[[ee,x.value]]),n[1]||(n[1]=a("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},[a("i",{class:"fas fa-search"})],-1))])]),a("div",Re,[w(t).loading&&!w(t).activeConversation?(u(),h("div",We,n[3]||(n[3]=[a("i",{class:"fas fa-circle-notch fa-spin text-blue-500 text-xl"},null,-1),a("p",{class:"mt-2 text-gray-500"},"Đang tải danh sách...",-1)]))):p.value.length===0?(u(),h("div",Oe,n[4]||(n[4]=[a("i",{class:"fas fa-comments text-gray-300 text-4xl"},null,-1),a("p",{class:"mt-2 text-gray-500"},"Không có cuộc trò chuyện nào",-1)]))):(u(!0),h(V,{key:2},G(p.value,r=>(u(),Q($e,{key:r.id,"display-name":H(r),avatar:r.avatar,"last-message":r.lastMessage,"last-message-time":r.lastMessageTime,"unread-count":r.unreadCount,"is-online":r.isOnline,"is-active":w(t).activeConversation===r.userId,userId:r.userId,onSelect:k=>F(r.userId)},null,8,["display-name","avatar","last-message","last-message-time","unread-count","is-online","is-active","userId","onSelect"]))),128))])]),a("div",Ee,[w(t).activeConversation?(u(),h(V,{key:0},[a("div",Fe,[a("div",Ve,[a("div",qe,[(s=C.value)!=null&&s.avatar&&se((i=C.value)==null?void 0:i.avatar)?(u(),h("img",{key:0,src:C.value.avatar,alt:"Avatar",class:"w-full h-full object-cover",onError:ne},null,40,Pe)):(u(),h("div",Ke,U(K()),1))]),a("div",null,[a("h3",Ye,U(q()),1),(c=C.value)!=null&&c.isOnline?(u(),h("p",ze,n[5]||(n[5]=[a("i",{class:"fas fa-circle mr-1 text-[8px]"},null,-1),J(" Đang hoạt động ")]))):B("",!0)])])]),a("div",{class:"flex-1 p-4 overflow-y-auto flex flex-col relative bg-gray-50",ref_key:"messagesContainer",ref:g,onScroll:te},[!T.value&&w(t).sortedMessages.length>5?(u(),h("button",{key:0,onClick:I,class:"absolute bottom-4 right-4 bg-blue-500 hover:bg-blue-600 text-white rounded-full p-2 shadow-md z-10 transition-colors",title:"Cuộn xuống tin nhắn mới nhất"},n[6]||(n[6]=[a("i",{class:"fas fa-arrow-down"},null,-1)]))):B("",!0),M.value?(u(),h("div",Ge,n[7]||(n[7]=[a("i",{class:"fas fa-circle-notch fa-spin text-blue-500"},null,-1),a("p",{class:"text-xs text-gray-500"},"Đang tải thêm tin nhắn cũ hơn...",-1)]))):B("",!0),w(t).loading&&!w(t).sortedMessages.length?(u(),h("div",Qe,n[8]||(n[8]=[a("i",{class:"fas fa-circle-notch fa-spin text-blue-500 text-xl"},null,-1),a("p",{class:"mt-2 text-gray-500"},"Đang tải tin nhắn...",-1),a("p",{class:"text-xs text-gray-400 mt-1"},"Đang tải nhiều trang để hiển thị đầy đủ cuộc trò chuyện",-1)]))):w(t).sortedMessages.length?(u(),h(V,{key:4},[a("div",Ze,[(u(!0),h(V,null,G(w(t).sortedMessages,r=>(u(),Q(pe,{key:r.id,content:r.content,"is-current-user":r.sender===o.value,"is-read":r.is_read,"created-at":r.created_at},null,8,["content","is-current-user","is-read","created-at"]))),128))]),w(t).loading&&w(t).sortedMessages.length?(u(),h("div",Xe,n[10]||(n[10]=[a("i",{class:"fas fa-circle-notch fa-spin text-blue-500"},null,-1),a("p",{class:"text-xs text-gray-500"},"Đang tải tin nhắn...",-1)]))):B("",!0)],64)):(u(),h("div",Je,n[9]||(n[9]=[a("i",{class:"fas fa-comment-dots text-gray-300 text-5xl mb-3"},null,-1),a("p",{class:"mt-2 text-gray-500"},"Chưa có tin nhắn. Hãy gửi tin nhắn đầu tiên!",-1)])))],544),ge(Le,{loading:w(t).loading,onSendMessage:L},null,8,["loading"])],64)):(u(),h("div",et,n[11]||(n[11]=[a("i",{class:"fas fa-comments text-gray-300 text-6xl mb-4"},null,-1),a("h3",{class:"text-xl font-medium text-gray-700 mb-2"},"Trò chuyện của bạn",-1),a("p",{class:"text-gray-500 text-center max-w-md"}," Chọn một cuộc trò chuyện từ danh sách bên trái hoặc bắt đầu một cuộc trò chuyện mới. ",-1)])))])])}}};export{st as _};
