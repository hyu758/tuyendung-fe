import{I as q,h as K,C as L,J as Q,i as Y,j as V,E as P,D as T,G as W,k as ee,r as te,c as d,o as c,d as e,b as w,f as a,t as b,l as k,e as S,n as _,m as M,v as se,F as D,g as F,K as re,L as A,H as oe}from"./index-Bw2aqbXG.js";const ne=q("profile",{state:()=>({profile:null,loading:!1,error:null}),getters:{fullName:u=>{var s;return((s=u.profile)==null?void 0:s.fullname)||""},gender:u=>{var s;return((s=u.profile)==null?void 0:s.gender)||""},email:u=>{var s;return((s=u.profile)==null?void 0:s.email)||""},phoneNumber:u=>{var s;return((s=u.profile)==null?void 0:s.phone)||""}},actions:{async fetchProfile(){var u,s;this.loading=!0,this.error=null;try{const y=K().token,i=await L.get("/api/profile/");if(console.log("Dữ liệu profile từ API:",i.data),i.data.status===200)return this.profile=i.data.data,{success:!0,data:this.profile};throw new Error(i.data.message||"Không thể lấy thông tin hồ sơ")}catch(h){return console.error("Lỗi khi lấy thông tin hồ sơ:",h),this.error=((s=(u=h.response)==null?void 0:u.data)==null?void 0:s.message)||"Không thể lấy thông tin hồ sơ. Vui lòng thử lại.",{success:!1,error:this.error}}finally{this.loading=!1}},async updateProfile(u){var s,h,y;this.loading=!0,this.error=null;try{const g=K().token;console.log("Dữ liệu gửi đi:",u),(!this.profile||!this.profile.user)&&await this.fetchProfile();const f=await L.put("/api/profile/update/",{fullname:u.fullname,gender:u.gender,user:this.profile.user});if(console.log("Kết quả cập nhật:",f.data),f.data.status===200)return await this.fetchProfile(),localStorage.setItem("notification",JSON.stringify({type:"success",message:"Cập nhật thông tin hồ sơ thành công!",show:!0})),{success:!0};throw new Error(f.data.message||"Cập nhật thông tin hồ sơ thất bại")}catch(i){return console.error("Lỗi khi cập nhật hồ sơ:",i),console.error("Chi tiết lỗi:",(s=i.response)==null?void 0:s.data),this.error=((y=(h=i.response)==null?void 0:h.data)==null?void 0:y.message)||"Không thể cập nhật hồ sơ. Vui lòng thử lại.",localStorage.setItem("notification",JSON.stringify({type:"error",message:this.error,show:!0})),{success:!1,error:this.error}}finally{this.loading=!1}},async changePassword(u){var s,h,y,i;this.loading=!0,this.error=null;try{const f=K().token,v=await L.post("/api/change-password/",{current_password:u.currentPassword,new_password:u.newPassword,confirm_password:u.confirmPassword});if(v.data.status===200)return localStorage.setItem("notification",JSON.stringify({type:"success",message:"Đổi mật khẩu thành công!",show:!0})),{success:!0};throw new Error(v.data.message||"Đổi mật khẩu thất bại")}catch(g){console.error("Lỗi khi đổi mật khẩu:",g);const f=((h=(s=g.response)==null?void 0:s.data)==null?void 0:h.message)||"Không thể đổi mật khẩu. Vui lòng thử lại.",v=((i=(y=g.response)==null?void 0:y.data)==null?void 0:i.errors)||{};return this.error=f,localStorage.setItem("notification",JSON.stringify({type:"error",message:f,show:!0})),{success:!1,error:f,errors:v}}finally{this.loading=!1}}}}),le={class:"bg-gray-50 min-h-screen py-8"},ie={class:"container mx-auto px-4 sm:px-6 lg:px-8"},ae={class:"bg-white rounded-xl shadow-lg overflow-hidden"},ue={class:"flex flex-col md:flex-row"},de={class:"md:w-1/4 bg-gray-50 p-6 border-b md:border-b-0 md:border-r border-gray-200"},ce={class:"flex flex-col items-center mb-8"},fe={class:"w-28 h-28 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center overflow-hidden border-4 border-white shadow-md"},he={class:"text-lg font-semibold text-gray-800 mt-4"},me={key:0,class:"text-xs font-bold bg-gradient-to-r from-yellow-500 to-amber-500 text-white px-3 py-1 rounded-full mb-1 shadow-sm flex items-center justify-center"},ge={class:"text-gray-500 text-sm"},pe={class:"space-y-3"},be={class:"md:w-3/4 p-6"},ye={key:0,class:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10 rounded-xl"},ve={key:1,class:"transition-all duration-300"},xe={class:"text-xl font-semibold mb-6 flex items-center text-gray-800"},we={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ke={class:"lg:col-span-2"},_e={class:"relative"},Pe={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},Se=["value"],Ce={class:"lg:col-span-2"},Ne={class:"relative"},Me={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},Ee={class:"lg:col-span-2"},Ve={class:"grid grid-cols-3 gap-3"},Ke=["id","value"],Le=["for"],Te={key:0,class:"lg:col-span-2 mt-2"},Ae={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},je={class:"flex items-center"},Ie={class:"text-sm text-gray-600"},De={class:"lg:col-span-2 flex justify-end"},Fe=["disabled"],Oe={key:0},Ue={key:1},$e={key:2,class:"transition-all duration-300"},ze={class:"text-xl font-semibold mb-6 flex items-center text-gray-800"},Je={class:"space-y-6"},Be={class:"relative"},He={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},Xe=["type"],Ge={class:"relative"},Re={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},Ze=["type"],qe={key:0,class:"mt-2"},Qe={class:"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden"},Ye={class:"flex justify-between mt-1"},We={class:"text-xs text-gray-500"},et={class:"relative"},tt={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},st=["type"],rt={key:0,class:"mt-2"},ot={class:"flex items-center"},nt={key:0,class:"bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded"},lt={class:"flex items-center"},it={key:0,class:"mt-2 ml-6 list-disc text-sm"},at={class:"bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded"},ut={class:"flex"},dt={class:"flex justify-end"},ct=["disabled"],ft={key:0},ht={key:1},gt={__name:"Profile",setup(u){const s=ne(),h=K(),y=Q(),i=Y(),g=V("profile"),f=V(""),v=V(null),m=V(0),j=P(()=>{var r,t;return((r=s.profile)==null?void 0:r.is_premium)===!0||((t=h.user)==null?void 0:t.is_premium)===!0||!1}),O=P(()=>{var l,N;const r=((l=s.profile)==null?void 0:l.premium_expiry)||((N=h.user)==null?void 0:N.premium_expiry);return r?new Date(r).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}):"Không xác định"}),x=T({fullname:"",gender:"male"}),n=T({currentPassword:"",newPassword:"",confirmPassword:""}),p=T({current:!1,new:!1,confirm:!1}),U=[{value:"male",label:"Nam",icon:["fas","mars"]},{value:"female",label:"Nữ",icon:["fas","venus"]},{value:"other",label:"Khác",icon:["fas","venus-mars"]}],$=()=>{const r=n.newPassword;if(!r){m.value=0;return}let t=0;r.length>=8?t+=20:r.length>=6&&(t+=10),/[A-Z]/.test(r)&&(t+=20),/[a-z]/.test(r)&&(t+=20),/[0-9]/.test(r)&&(t+=20),/[^A-Za-z0-9]/.test(r)&&(t+=20),m.value=t},z=P(()=>m.value<30?"bg-red-500":m.value<60?"bg-yellow-500":m.value<80?"bg-blue-500":"bg-green-500"),J=P(()=>m.value<30?"Rất yếu":m.value<60?"Yếu":m.value<80?"Tốt":"Mạnh"),B=P(()=>m.value<30?"text-red-600":m.value<60?"text-yellow-600":m.value<80?"text-blue-600":"text-green-600"),C=P(()=>n.confirmPassword?n.newPassword===n.confirmPassword:!1),H=P(()=>n.currentPassword&&n.newPassword&&n.confirmPassword&&C.value&&m.value>=60);function X(r){return{current_password:"Mật khẩu hiện tại",new_password:"Mật khẩu mới",confirm_password:"Xác nhận mật khẩu"}[r]||r}W(n,()=>{f.value="",v.value=null}),ee(async()=>{h.isAuthenticated&&!h.user&&h.updateUserFromToken(),(await s.fetchProfile()).success&&(x.fullname=s.profile.fullname||"",x.gender=s.profile.gender||"male"),G()});async function G(){y.isPremium&&y.isPremiumExpired&&await y.cancelPremium()}async function R(){try{const r=await s.updateProfile(x);r.success?i.success("Cập nhật thông tin thành công!"):i.error(r.error||"Có lỗi xảy ra khi cập nhật thông tin")}catch(r){console.error("Error updating profile:",r),i.error("Có lỗi xảy ra khi cập nhật thông tin")}}async function Z(){if(f.value="",v.value=null,n.newPassword!==n.confirmPassword){f.value="Mật khẩu mới và xác nhận mật khẩu không khớp nhau",i.error("Mật khẩu mới và xác nhận mật khẩu không khớp nhau");return}if(n.newPassword.length<6){f.value="Mật khẩu mới phải có ít nhất 6 ký tự",i.error("Mật khẩu mới phải có ít nhất 6 ký tự");return}try{const r=await s.changePassword(n);r.success?(n.currentPassword="",n.newPassword="",n.confirmPassword="",m.value=0,i.success("Đổi mật khẩu thành công!")):(f.value=r.error,i.error(r.error||"Có lỗi xảy ra khi đổi mật khẩu"),r.errors&&(v.value=r.errors,Object.values(r.errors).forEach(t=>{Array.isArray(t)?i.error(t[0]):i.error(t)})))}catch(r){console.error("Error changing password:",r),i.error("Có lỗi xảy ra khi đổi mật khẩu")}}return(r,t)=>{var N,I;const l=te("font-awesome-icon");return c(),d("div",le,[e("div",ie,[t[24]||(t[24]=e("div",{class:"mb-8"},[e("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-900"},"Hồ sơ người dùng"),e("p",{class:"mt-2 text-sm text-gray-600"},"Quản lý thông tin cá nhân và bảo mật tài khoản")],-1)),e("div",ae,[e("div",ue,[e("div",de,[e("div",ce,[e("div",fe,[a(l,{icon:["fas","user"],class:"text-white text-4xl"})]),e("h3",he,b(((N=k(s).profile)==null?void 0:N.fullname)||"Người dùng"),1),j.value?(c(),d("div",me,[a(l,{icon:["fas","crown"],class:"mr-1 text-xs"}),S(" "+b(((I=k(s).profile)==null?void 0:I.name_display)||"Premium"),1)])):w("",!0),e("p",ge,b(k(s).email),1)]),e("nav",pe,[e("button",{onClick:t[0]||(t[0]=o=>g.value="profile"),class:_(["w-full text-left px-4 py-3 rounded-lg transition-all duration-200 flex items-center",g.value==="profile"?"bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 font-medium border-l-4 border-blue-500":"hover:bg-gray-100 text-gray-700"])},[a(l,{icon:["fas","user"],class:"mr-3"}),t[10]||(t[10]=S(" Thông tin cá nhân "))],2),e("button",{onClick:t[1]||(t[1]=o=>g.value="password"),class:_(["w-full text-left px-4 py-3 rounded-lg transition-all duration-200 flex items-center",g.value==="password"?"bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 font-medium border-l-4 border-blue-500":"hover:bg-gray-100 text-gray-700"])},[a(l,{icon:["fas","lock"],class:"mr-3"}),t[11]||(t[11]=S(" Đổi mật khẩu "))],2)])]),e("div",be,[k(s).loading?(c(),d("div",ye,t[12]||(t[12]=[e("div",{class:"flex flex-col items-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"}),e("span",{class:"mt-3 text-gray-600"},"Đang xử lý...")],-1)]))):w("",!0),g.value==="profile"?(c(),d("div",ve,[e("h2",xe,[a(l,{icon:["fas","user-edit"],class:"mr-3 text-blue-500"}),t[13]||(t[13]=S(" Cập nhật thông tin cá nhân "))]),e("div",we,[e("div",ke,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),e("div",_e,[e("div",Pe,[a(l,{icon:["fas","envelope"],class:"text-gray-400"})]),e("input",{type:"text",value:k(s).email,class:"w-full py-3 pl-10 pr-3 rounded-lg border border-gray-300 bg-gray-50 text-gray-600 focus:ring-0",readonly:""},null,8,Se),t[14]||(t[14]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[e("span",{class:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded"},"Xác thực")],-1))])]),e("div",Ce,[t[16]||(t[16]=e("label",{for:"fullname",class:"block text-sm font-medium text-gray-700 mb-1"},"Họ và tên",-1)),e("div",Ne,[e("div",Me,[a(l,{icon:["fas","user"],class:"text-gray-400"})]),M(e("input",{id:"fullname",type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>x.fullname=o),class:"w-full py-3 pl-10 pr-3 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Nhập họ và tên của bạn"},null,512),[[se,x.fullname]])])]),e("div",Ee,[t[17]||(t[17]=e("label",{for:"gender",class:"block text-sm font-medium text-gray-700 mb-1"},"Giới tính",-1)),e("div",Ve,[(c(),d(D,null,F(U,o=>e("div",{class:"relative",key:o.value},[M(e("input",{type:"radio",id:"gender-"+o.value,value:o.value,"onUpdate:modelValue":t[3]||(t[3]=E=>x.gender=E),class:"sr-only peer"},null,8,Ke),[[re,x.gender]]),e("label",{for:"gender-"+o.value,class:"flex items-center justify-center p-3 w-full bg-white border rounded-lg cursor-pointer peer-checked:border-blue-600 peer-checked:bg-blue-50 hover:bg-gray-50 transition-all"},[a(l,{icon:o.icon,class:_(["mr-2",x.gender===o.value?"text-blue-600":"text-gray-400"])},null,8,["icon","class"]),e("span",{class:_(x.gender===o.value?"text-blue-700 font-medium":"text-gray-700")},b(o.label),3)],8,Le)])),64))])]),j.value?(c(),d("div",Te,[e("div",Ae,[e("div",je,[a(l,{icon:["fas","crown"],class:"text-yellow-500 mr-3"}),e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm font-medium text-gray-800"},"Thời hạn Premium",-1)),e("p",Ie,b(O.value),1)])])])])):w("",!0),e("div",De,[e("button",{onClick:R,disabled:k(s).loading,class:"px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all shadow-md transform hover:-translate-y-0.5 active:translate-y-0"},[a(l,{icon:["fas","save"],class:"mr-2"}),k(s).loading?(c(),d("span",Oe,"Đang cập nhật...")):(c(),d("span",Ue,"Lưu thay đổi"))],8,Fe)])])])):w("",!0),g.value==="password"?(c(),d("div",$e,[e("h2",ze,[a(l,{icon:["fas","key"],class:"mr-3 text-blue-500"}),t[19]||(t[19]=S(" Thay đổi mật khẩu "))]),e("div",Je,[e("div",null,[t[20]||(t[20]=e("label",{for:"currentPassword",class:"block text-sm font-medium text-gray-700 mb-1"},"Mật khẩu hiện tại",-1)),e("div",Be,[e("div",He,[a(l,{icon:["fas","lock"],class:"text-gray-400"})]),M(e("input",{id:"currentPassword",type:p.current?"text":"password","onUpdate:modelValue":t[4]||(t[4]=o=>n.currentPassword=o),class:"w-full py-3 pl-10 pr-12 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Nhập mật khẩu hiện tại"},null,8,Xe),[[A,n.currentPassword]]),e("button",{type:"button",onClick:t[5]||(t[5]=o=>p.current=!p.current),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 focus:outline-none transition-colors"},[a(l,{icon:p.current?["fas","eye-slash"]:["fas","eye"],class:"text-lg"},null,8,["icon"])])])]),e("div",null,[t[21]||(t[21]=e("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700 mb-1"},"Mật khẩu mới",-1)),e("div",Ge,[e("div",Re,[a(l,{icon:["fas","lock"],class:"text-gray-400"})]),M(e("input",{id:"newPassword",type:p.new?"text":"password","onUpdate:modelValue":t[6]||(t[6]=o=>n.newPassword=o),class:"w-full py-3 pl-10 pr-12 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Nhập mật khẩu mới",onInput:$},null,40,Ze),[[A,n.newPassword]]),e("button",{type:"button",onClick:t[7]||(t[7]=o=>p.new=!p.new),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 focus:outline-none transition-colors"},[a(l,{icon:p.new?["fas","eye-slash"]:["fas","eye"],class:"text-lg"},null,8,["icon"])])]),n.newPassword?(c(),d("div",qe,[e("div",Qe,[e("div",{class:_(["h-full transition-all duration-300",z.value]),style:oe({width:`${m.value}%`})},null,6)]),e("div",Ye,[e("span",{class:_(["text-xs",B.value])},b(J.value),3),e("span",We,b(n.newPassword.length)+" ký tự",1)])])):w("",!0)]),e("div",null,[t[22]||(t[22]=e("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700 mb-1"},"Xác nhận mật khẩu mới",-1)),e("div",et,[e("div",tt,[a(l,{icon:["fas","shield-alt"],class:"text-gray-400"})]),M(e("input",{id:"confirmPassword",type:p.confirm?"text":"password","onUpdate:modelValue":t[8]||(t[8]=o=>n.confirmPassword=o),class:"w-full py-3 pl-10 pr-12 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Nhập lại mật khẩu mới"},null,8,st),[[A,n.confirmPassword]]),e("button",{type:"button",onClick:t[9]||(t[9]=o=>p.confirm=!p.confirm),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 focus:outline-none transition-colors"},[a(l,{icon:p.confirm?["fas","eye-slash"]:["fas","eye"],class:"text-lg"},null,8,["icon"])])]),n.confirmPassword?(c(),d("div",rt,[e("div",ot,[a(l,{icon:C.value?["fas","check-circle"]:["fas","times-circle"],class:_([C.value?"text-green-500":"text-red-500","mr-2"])},null,8,["icon","class"]),e("span",{class:_(["text-xs",C.value?"text-green-600":"text-red-600"])},b(C.value?"Mật khẩu khớp":"Mật khẩu không khớp"),3)])])):w("",!0)]),f.value?(c(),d("div",nt,[e("div",lt,[a(l,{icon:["fas","exclamation-circle"],class:"mr-2"}),e("div",null,[e("p",null,b(f.value),1),v.value?(c(),d("ul",it,[(c(!0),d(D,null,F(v.value,(o,E)=>(c(),d("li",{key:E},[e("strong",null,b(X(E))+":",1),S(" "+b(Array.isArray(o)?o[0]:o),1)]))),128))])):w("",!0)])])])):w("",!0),e("div",at,[e("div",ut,[a(l,{icon:["fas","info-circle"],class:"mr-2 mt-0.5"}),t[23]||(t[23]=e("div",null,[e("p",{class:"font-medium mb-1"},"Lời khuyên bảo mật:"),e("ul",{class:"text-sm ml-6 list-disc"},[e("li",null,"Sử dụng ít nhất 8 ký tự"),e("li",null,"Kết hợp chữ hoa, chữ thường, số và ký tự đặc biệt"),e("li",null,"Không sử dụng thông tin cá nhân như tên hoặc ngày sinh"),e("li",null,"Không sử dụng cùng một mật khẩu cho nhiều tài khoản")])],-1))])]),e("div",dt,[e("button",{onClick:Z,disabled:k(s).loading||!H.value,class:"px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all shadow-md transform hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:pointer-events-none"},[a(l,{icon:["fas","key"],class:"mr-2"}),k(s).loading?(c(),d("span",ft,"Đang cập nhật...")):(c(),d("span",ht,"Đổi mật khẩu"))],8,ct)])])])):w("",!0)])])])])])}}};export{gt as default};
